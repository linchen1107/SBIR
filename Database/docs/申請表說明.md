# ç”³è«‹è¡¨ç³»çµ±èªªæ˜æ–‡ä»¶

## ğŸ“‹ æ¦‚è¿°

ç‚ºäº†è¦ç¯„å» å•†ä»£è™Ÿå’ŒCIDï¼ˆè£å‚™è­˜åˆ¥ç¢¼ï¼‰çš„ç”³è«‹æµç¨‹ï¼Œæ–°å¢äº†ç”³è«‹è¡¨ç³»çµ±ã€‚ç”³è«‹å–®å¯©æ ¸é€šéå¾Œï¼Œæ‰æœƒåœ¨æ­£å¼è¡¨ï¼ˆSupplier / Equipmentï¼‰ä¸­å»ºç«‹è¨˜éŒ„ã€‚

**å»ºç«‹æ—¥æœŸ**: 2025-11-17
**ç‰ˆæœ¬**: V2.0

---

## ğŸ“Š ç”³è«‹è¡¨æ¶æ§‹

### æ–°å¢è¡¨æ ¼ç¸½è¦½

| ç·¨è™Ÿ | è¡¨å | ä¸­æ–‡åç¨± | ä¸»éµé¡å‹ | ç”¨é€” |
|------|------|---------|---------|------|
| 1 | SupplierApplication | å» å•†ç”³è«‹è¡¨ | UUID | ç®¡ç†å» å•†ä»£è™Ÿç”³è«‹æµç¨‹ |
| 2 | EquipmentApplication | CIDç”³è«‹è¡¨ | UUID | ç®¡ç†è£å‚™è­˜åˆ¥ç¢¼ç”³è«‹æµç¨‹ |

**è¨»**: ApplicationStatusHistory (ç”³è«‹ç‹€æ…‹æ­·å²è¡¨) å·²æ–¼ V2.0 ç§»é™¤ï¼Œä¸å†ä½¿ç”¨ç¨ç«‹çš„æ­·å²è¨˜éŒ„è¡¨

---

## 1. SupplierApplication (å» å•†ç”³è«‹è¡¨)

### ç”¨é€”
ç®¡ç†å» å•†ä»£è™Ÿçš„ç”³è«‹æµç¨‹ã€‚ç”³è«‹äººæäº¤å» å•†è³‡æ–™å¾Œï¼Œç¶“å¯©æ ¸é€šéæ‰æœƒåœ¨ Supplier è¡¨ä¸­å»ºç«‹æ­£å¼è¨˜éŒ„ã€‚

### è¡¨çµæ§‹

| è‹±æ–‡æ¬„ä½å | ä¸­æ–‡åç¨± | è³‡æ–™é¡å‹ | æ¨™è¨˜ | èªªæ˜ |
|-----------|---------|---------|------|------|
| **ä¸»éµ** ||||
| application_id | ç”³è«‹å–®ID | UUID | ğŸ”‘ğŸ”„ | è‡ªå‹•ç”ŸæˆUUID |
| **ç”³è«‹çš„å» å•†è³‡æ–™** ||||
| supplier_code | å» å•†ä¾†æºä»£è™Ÿ | VARCHAR(20) | ğŸ“ | ç”³è«‹çš„å» å•†ä»£ç¢¼ |
| cage_code | å» å®¶ç™»è¨˜ä»£è™Ÿ | VARCHAR(20) | ğŸ“ | ç”³è«‹çš„CAGE CODE |
| supplier_name_en | å» å•†è‹±æ–‡åç¨± | VARCHAR(200) | â­ | å¿…å¡« |
| supplier_name_zh | å» å•†ä¸­æ–‡åç¨± | VARCHAR(100) | ğŸ“ | é¸å¡« |
| supplier_type | å» å•†é¡å‹ | VARCHAR(20) | ğŸ“ | è£½é€ å•†/ä»£ç†å•† |
| country_code | åœ‹å®¶ä»£ç¢¼ | VARCHAR(10) | ğŸ“ | åœ‹åˆ¥ä»£ç¢¼ |
| **ç”³è«‹æµç¨‹è³‡è¨Š** ||||
| application_status | ç”³è«‹ç‹€æ…‹ | VARCHAR(20) | â­ | pending/approved/rejected/cancelled |
| applicant_name | ç”³è«‹äººå§“å | VARCHAR(100) | â­ | å¿…å¡« |
| applicant_email | ç”³è«‹äººä¿¡ç®± | VARCHAR(100) | ğŸ“ | é¸å¡« |
| applicant_unit | ç”³è«‹äººå–®ä½ | VARCHAR(100) | ğŸ“ | é¸å¡« |
| application_date | ç”³è«‹æ—¥æœŸ | DATE | ğŸ”„ | é è¨­ä»Šæ—¥ |
| **å¯©æ ¸è³‡è¨Š** ||||
| review_date | å¯©æ ¸æ—¥æœŸ | DATE | ğŸ“ | å¯©æ ¸æ™‚å¡«å…¥ |
| reviewer_name | å¯©æ ¸äººå§“å | VARCHAR(100) | ğŸ“ | å¯©æ ¸äºº |
| review_comment | å¯©æ ¸æ„è¦‹ | TEXT | ğŸ“ | å¯©æ ¸å‚™è¨» |
| **é—œè¯æ¬„ä½** ||||
| supplier_id | æ­£å¼å» å•†ID | INT | ğŸ”—ğŸ“ | å¯©æ ¸é€šéå¾Œçš„Supplier ID |
| **æ™‚é–“æˆ³** ||||
| created_at | å»ºç«‹æ™‚é–“ | TIMESTAMP | ğŸ”„ | è‡ªå‹•æ™‚é–“æˆ³ |
| updated_at | æ›´æ–°æ™‚é–“ | TIMESTAMP | ğŸ”„ | è‡ªå‹•æ›´æ–° |

### ç”³è«‹ç‹€æ…‹èªªæ˜

- **pending** (å¾…å¯©æ ¸): ç”³è«‹å·²æäº¤ï¼Œç­‰å¾…å¯©æ ¸
- **approved** (å·²æ ¸å‡†): ç”³è«‹é€šéï¼Œå·²åœ¨ Supplier è¡¨å»ºç«‹è¨˜éŒ„
- **rejected** (å·²æ‹’çµ•): ç”³è«‹è¢«æ‹’çµ•
- **cancelled** (å·²å–æ¶ˆ): ç”³è«‹äººå–æ¶ˆç”³è«‹

### ç´¢å¼•

- `idx_supplier_app_status` - ç”³è«‹ç‹€æ…‹ç´¢å¼•
- `idx_supplier_app_date` - ç”³è«‹æ—¥æœŸç´¢å¼•
- `idx_supplier_app_applicant` - ç”³è«‹äººç´¢å¼•

### å¤–éµé—œè¯

- `supplier_id` â†’ `Supplier.supplier_id` (ON DELETE SET NULL)

### è§¸ç™¼å™¨

- `update_supplier_application_updated_at` - è‡ªå‹•æ›´æ–°æ™‚é–“æˆ³

---

## 2. EquipmentApplication (CIDç”³è«‹è¡¨)

### ç”¨é€”
ç®¡ç†CIDï¼ˆè£å‚™è­˜åˆ¥ç¢¼ï¼‰çš„ç”³è«‹æµç¨‹ã€‚ç”³è«‹äººæäº¤è£å‚™è³‡æ–™å¾Œï¼Œç¶“å¯©æ ¸é€šéæ‰æœƒåœ¨ Equipment è¡¨ä¸­å»ºç«‹æ­£å¼è¨˜éŒ„ã€‚

### è¡¨çµæ§‹

| è‹±æ–‡æ¬„ä½å | ä¸­æ–‡åç¨± | è³‡æ–™é¡å‹ | æ¨™è¨˜ | èªªæ˜ |
|-----------|---------|---------|------|------|
| **ä¸»éµ** ||||
| application_id | ç”³è«‹å–®ID | UUID | ğŸ”‘ğŸ”„ | è‡ªå‹•ç”ŸæˆUUID |
| **ç”³è«‹çš„è£å‚™è³‡æ–™** ||||
| equipment_id | ç”³è«‹çš„CID | VARCHAR(50) | â­ | ç”³è«‹çš„è£å‚™è­˜åˆ¥ç¢¼ |
| equipment_name_zh | è£å‚™ä¸­æ–‡åç¨± | VARCHAR(100) | â­ | å¿…å¡« |
| equipment_name_en | è£å‚™è‹±æ–‡åç¨± | VARCHAR(200) | â­ | å¿…å¡« |
| equipment_type | è£å‚™å½¢å¼ | VARCHAR(50) | ğŸ“ | è£å‚™å‹è™Ÿ |
| ship_type | è‰¦å‹ | VARCHAR(50) | ğŸ“ | é©ç”¨è‰¦å‹ |
| position | è£è¨­åœ°é» | VARCHAR(100) | ğŸ“ | å®‰è£ä½ç½® |
| parent_equipment_zh | ä¸Šå±¤è£å‚™ä¸­æ–‡åç¨± | VARCHAR(100) | ğŸ“ | çˆ¶è£å‚™ |
| parent_equipment_en | ä¸Šå±¤è£å‚™è‹±æ–‡åç¨± | VARCHAR(200) | ğŸ“ | çˆ¶è£å‚™ |
| parent_cid | ä¸Šå±¤CID | VARCHAR(50) | ğŸ”—ğŸ“ | çˆ¶è£å‚™CID |
| eswbs_code | ESWBSç¢¼ | VARCHAR(20) | ğŸ“ | è£å‚™åˆ†é¡ç¢¼ |
| system_function_name | ç³»çµ±åŠŸèƒ½åç¨± | VARCHAR(200) | ğŸ“ | åŠŸèƒ½èªªæ˜ |
| installation_qty | åŒä¸€é¡å‹æ•¸é‡ | INT | ğŸ“ | è£ç½®æ•¸é‡ |
| total_installation_qty | å…¨è‰¦è£ç½®æ•¸ | INT | ğŸ“ | å…¨è‰¦ç¸½æ•¸ |
| maintenance_level | ç¶­ä¿®ç­‰ç´šä»£ç¢¼ | VARCHAR(10) | ğŸ“ | ç¶­ä¿®ç­‰ç´š |
| equipment_serial | è£å‚™åºè™Ÿ | VARCHAR(50) | ğŸ“ | è£å‚™åºè™Ÿ |
| **ç”³è«‹æµç¨‹è³‡è¨Š** ||||
| application_status | ç”³è«‹ç‹€æ…‹ | VARCHAR(20) | â­ | pending/approved/rejected/cancelled |
| applicant_name | ç”³è«‹äººå§“å | VARCHAR(100) | â­ | å¿…å¡« |
| applicant_email | ç”³è«‹äººä¿¡ç®± | VARCHAR(100) | ğŸ“ | é¸å¡« |
| applicant_unit | ç”³è«‹äººå–®ä½ | VARCHAR(100) | ğŸ“ | é¸å¡« |
| application_date | ç”³è«‹æ—¥æœŸ | DATE | ğŸ”„ | é è¨­ä»Šæ—¥ |
| **å¯©æ ¸è³‡è¨Š** ||||
| review_date | å¯©æ ¸æ—¥æœŸ | DATE | ğŸ“ | å¯©æ ¸æ™‚å¡«å…¥ |
| reviewer_name | å¯©æ ¸äººå§“å | VARCHAR(100) | ğŸ“ | å¯©æ ¸äºº |
| review_comment | å¯©æ ¸æ„è¦‹ | TEXT | ğŸ“ | å¯©æ ¸å‚™è¨» |
| **é—œè¯æ¬„ä½** ||||
| approved_equipment_id | æ­£å¼è£å‚™ID | VARCHAR(50) | ğŸ”—ğŸ“ | å¯©æ ¸é€šéå¾Œçš„Equipment ID |
| **æ™‚é–“æˆ³** ||||
| created_at | å»ºç«‹æ™‚é–“ | TIMESTAMP | ğŸ”„ | è‡ªå‹•æ™‚é–“æˆ³ |
| updated_at | æ›´æ–°æ™‚é–“ | TIMESTAMP | ğŸ”„ | è‡ªå‹•æ›´æ–° |

### ç”³è«‹ç‹€æ…‹èªªæ˜

- **pending** (å¾…å¯©æ ¸): ç”³è«‹å·²æäº¤ï¼Œç­‰å¾…å¯©æ ¸
- **approved** (å·²æ ¸å‡†): ç”³è«‹é€šéï¼Œå·²åœ¨ Equipment è¡¨å»ºç«‹è¨˜éŒ„
- **rejected** (å·²æ‹’çµ•): ç”³è«‹è¢«æ‹’çµ•
- **cancelled** (å·²å–æ¶ˆ): ç”³è«‹äººå–æ¶ˆç”³è«‹

### ç´¢å¼•

- `idx_equipment_app_status` - ç”³è«‹ç‹€æ…‹ç´¢å¼•
- `idx_equipment_app_date` - ç”³è«‹æ—¥æœŸç´¢å¼•
- `idx_equipment_app_applicant` - ç”³è«‹äººç´¢å¼•
- `idx_equipment_app_cid` - ç”³è«‹CIDç´¢å¼•
- `idx_equipment_app_eswbs` - ESWBSç¢¼ç´¢å¼•

### å¤–éµé—œè¯

- `approved_equipment_id` â†’ `Equipment.equipment_id` (ON DELETE SET NULL)
- `parent_cid` â†’ `Equipment.equipment_id` (ON DELETE SET NULL)

### è§¸ç™¼å™¨

- `update_equipment_application_updated_at` - è‡ªå‹•æ›´æ–°æ™‚é–“æˆ³

---

## ğŸ“Š ç”³è«‹æµç¨‹åœ–

```
ç”³è«‹äººæäº¤ç”³è«‹
      â†“
 SupplierApplication / EquipmentApplication
 (status = pending)
      â†“
   å¯©æ ¸äººå“¡å¯©æ ¸
      â†“
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â†“           â†“
  é€šé         æ‹’çµ•
(approved)  (rejected)
    â†“           â†“
å»ºç«‹æ­£å¼è¨˜éŒ„   è¨˜éŒ„åŸå› 
Supplier /   review_comment
Equipment
    â†“
é—œè¯ supplier_id /
approved_equipment_id
```

---

## ğŸ”„ ä½¿ç”¨ç¯„ä¾‹

### ç¯„ä¾‹1ï¼šæäº¤å» å•†ç”³è«‹

```sql
INSERT INTO SupplierApplication (
    supplier_name_en,
    supplier_name_zh,
    supplier_code,
    cage_code,
    country_code,
    applicant_name,
    applicant_email,
    applicant_unit
) VALUES (
    'ABC Manufacturing Co., Ltd.',
    'ç”²ä¹™ä¸™è£½é€ è‚¡ä»½æœ‰é™å…¬å¸',
    'SUP001',
    'ABC123',
    'TW',
    'ç‹å°æ˜',
    'wang@navy.mil.tw',
    'å¾Œå‹¤æ”¯æ´è™•'
);
```

### ç¯„ä¾‹2ï¼šå¯©æ ¸é€šéå» å•†ç”³è«‹

```sql
-- 1. åœ¨ Supplier è¡¨å»ºç«‹æ­£å¼è¨˜éŒ„
INSERT INTO Supplier (
    supplier_code,
    cage_code,
    supplier_name_en,
    supplier_name_zh,
    country_code
)
SELECT
    supplier_code,
    cage_code,
    supplier_name_en,
    supplier_name_zh,
    country_code
FROM SupplierApplication
WHERE application_id = 'xxx-xxx-xxx-xxx'
RETURNING supplier_id;

-- 2. æ›´æ–°ç”³è«‹å–®ç‹€æ…‹
UPDATE SupplierApplication
SET
    application_status = 'approved',
    review_date = CURRENT_DATE,
    reviewer_name = 'æå¯©æ ¸',
    review_comment = 'è³‡æ–™å®Œæ•´ï¼Œæ ¸å‡†é€šé',
    supplier_id = [è¿”å›çš„supplier_id],
    updated_at = CURRENT_TIMESTAMP
WHERE application_id = 'xxx-xxx-xxx-xxx';
```

### ç¯„ä¾‹3ï¼šæŸ¥è©¢å¾…å¯©æ ¸çš„ç”³è«‹å–®

```sql
-- æŸ¥è©¢æ‰€æœ‰å¾…å¯©æ ¸çš„å» å•†ç”³è«‹
SELECT
    application_id,
    supplier_name_en,
    supplier_name_zh,
    applicant_name,
    applicant_unit,
    application_date,
    CURRENT_DATE - application_date AS days_pending
FROM SupplierApplication
WHERE application_status = 'pending'
ORDER BY application_date ASC;

-- æŸ¥è©¢æ‰€æœ‰å¾…å¯©æ ¸çš„CIDç”³è«‹
SELECT
    application_id,
    equipment_id,
    equipment_name_zh,
    equipment_name_en,
    applicant_name,
    applicant_unit,
    application_date,
    CURRENT_DATE - application_date AS days_pending
FROM EquipmentApplication
WHERE application_status = 'pending'
ORDER BY application_date ASC;
```

---

## âš ï¸ æ³¨æ„äº‹é …

1. **UUID ä¸»éµ**: ä½¿ç”¨ UUID ä½œç‚ºä¸»éµï¼Œå¯é¿å…IDçŒœæ¸¬å’Œè¡çªå•é¡Œ
2. **è³‡æ–™é©—è­‰**: åœ¨å¯©æ ¸é€šéå‰ï¼Œæ‡‰æª¢æŸ¥ç”³è«‹è³‡æ–™çš„å®Œæ•´æ€§å’Œåˆæ³•æ€§
3. **é‡è¤‡ç”³è«‹**: å»ºè­°åœ¨æ‡‰ç”¨å±¤é¢æª¢æŸ¥æ˜¯å¦æœ‰é‡è¤‡çš„ supplier_code æˆ– equipment_id ç”³è«‹
4. **æ¬Šé™æ§åˆ¶**: ç”³è«‹æäº¤å’Œå¯©æ ¸æ‡‰æœ‰ä¸åŒçš„æ¬Šé™ç­‰ç´š
5. **å‹•æ…‹æ¬„ä½**: SupplierApplication è¡¨æ”¯æ´å‹•æ…‹æ¬„ä½ï¼Œç”±å¾Œç«¯è™•ç†éˆæ´»çš„æ¬„ä½æ–°å¢éœ€æ±‚

---

## ğŸ”— èˆ‡ç¾æœ‰ç³»çµ±çš„é—œè¯

### é—œè¯åˆ°ä¸»è¡¨

```
SupplierApplication â†’ Supplier (å¯©æ ¸é€šéå¾Œ)
                      â†“
                supplier_id æ¬„ä½è¨˜éŒ„é—œè¯

EquipmentApplication â†’ Equipment (å¯©æ ¸é€šéå¾Œ)
                       â†“
                 approved_equipment_id æ¬„ä½è¨˜éŒ„é—œè¯
```

### å®Œæ•´è³‡æ–™åº«æ¶æ§‹ï¼ˆV2.0ï¼‰

```
[ç”³è«‹è¡¨ç³»çµ±]
â”œâ”€â”€ SupplierApplication (å» å•†ç”³è«‹)
â”‚   â””â”€â†’ Supplier (å¯©æ ¸é€šé)
â””â”€â”€ EquipmentApplication (CIDç”³è«‹)
    â””â”€â†’ Equipment (å¯©æ ¸é€šé)

[åŸæœ‰ç³»çµ±]
â”œâ”€â”€ Supplier (å» å•†ä¸»æª”)
â”œâ”€â”€ Equipment (è£å‚™ä¸»æª”ï¼Œå«è¦æ ¼èªªæ˜)
â”œâ”€â”€ Item (å“é …ä¸»æª”)
â”œâ”€â”€ BOM_xref (è£å‚™å“é …é—œè¯)
â””â”€â”€ ... (å…¶ä»–è¡¨)
```

---

**æ–‡ä»¶ç‰ˆæœ¬**: V2.0
**å»ºç«‹æ—¥æœŸ**: 2025-11-17
**æœ€å¾Œæ›´æ–°**: 2025-11-17
**ç¶­è­·å–®ä½**: SBIR å°ˆæ¡ˆåœ˜éšŠ

## ğŸ“ ç‰ˆæœ¬æ›´æ–°è¨˜éŒ„

### V2.0 (2025-11-17)
- âœ… ç§»é™¤ ApplicationStatusHistory (ç”³è«‹ç‹€æ…‹æ­·å²è¡¨)
- âœ… ç°¡åŒ–ç”³è«‹æµç¨‹ï¼Œåƒ…ä¿ç•™å…©å€‹ç”³è«‹è¡¨
- âœ… æ–°å¢å‹•æ…‹æ¬„ä½æ”¯æ´èªªæ˜ï¼ˆSupplierApplicationï¼‰
- âœ… æ›´æ–°ä½¿ç”¨ç¯„ä¾‹å’Œæ¶æ§‹åœ–

### V1.0 (2025-11-17)
- âœ… åˆç‰ˆå»ºç«‹
- âœ… æ–°å¢ SupplierApplication, EquipmentApplication, ApplicationStatusHistory
- âœ… å®Œæ•´çš„ç”³è«‹æµç¨‹èªªæ˜
