# è³‡æ–™åº«æ¬„ä½æ˜ å°„èªªæ˜æ–‡ä»¶ (V1.0 â†’ V3.2)

## ğŸ“‹ æ–‡ä»¶è³‡è¨Š

- **å»ºç«‹æ—¥æœŸ**: 2025-12-26
- **ç”¨é€”**: èˆŠè³‡æ–™åº« (V1.0) åˆ°æ–°è³‡æ–™åº« (V3.2) çš„å®Œæ•´æ¬„ä½æ˜ å°„
- **é©ç”¨ç¯„åœ**: è³‡æ–™é·ç§»ã€ç³»çµ±æ•´åˆã€æ¬„ä½å°ç…§æŸ¥è©¢
- **è³‡æ–™åº«åç¨±**: sbir_equipment_db_v3

---

## ğŸ“Š æ˜ å°„ç¸½è¦½

### èˆŠè³‡æ–™åº«è¡¨æ ¼æ¸…å–® (V1.0)

| ç·¨è™Ÿ | èˆŠè¡¨å | è¨˜éŒ„æ•¸ | æ–°è¡¨å | ç‹€æ…‹ |
|------|--------|--------|--------|------|
| 1 | `users` | - | `User` | âœ… é‡æ–°å‘½å + æ¬„ä½èª¿æ•´ |
| 2 | `applications` | - | `application` | âœ… é‡æ§‹ï¼šæ‹†åˆ†è‡³å¤šè¡¨ |
| 3 | `application_attachments` | - | `applicationattachment` | âœ… é‡æ–°å‘½å |
| 4 | `user_sessions` | - | `usersession` | âœ… é‡æ–°å‘½å |
| 5 | `application_logs` | - | `applicationlog` | âœ… é‡æ–°å‘½å |
| 6 | `audit_logs` | - | `auditlog` | âœ… é‡æ–°å‘½å |
| 7 | `search_history` | - | - | âŒ å·²ç§»é™¤ |
| 8 | `user_favorites` | - | - | âŒ å·²ç§»é™¤ |
| 9 | `user_settings` | - | - | âŒ å·²ç§»é™¤ |
| 10 | `system_settings` | - | - | âŒ å·²ç§»é™¤ |
| 11 | `system_statistics` | - | - | âŒ å·²ç§»é™¤ |

### æ–°è³‡æ–™åº«æ–°å¢è¡¨æ ¼ (V3.2)

| ç·¨è™Ÿ | æ–°è¡¨å | ç”¨é€” |
|------|--------|------|
| 1 | `item` | å“é …ä¸»æª”ï¼ˆæ ¸å¿ƒè¡¨ï¼‰ |
| 2 | `item_equipment_ext` | è£å‚™æ“´å±•è¡¨ |
| 3 | `item_material_ext` | æ–™ä»¶æ“´å±•è¡¨ |
| 4 | `item_emu3000_maintenance_ext` | EMU3000 ç¶­ä¿®ç‰©æ–™æ“´å±•è¡¨ |
| 5 | `supplier` | å» å•†ä¸»æª” |
| 6 | `bom` | BOM ä¸»è¡¨ |
| 7 | `bom_line` | BOM æ˜ç´°è¡Œ |
| 8 | `mrc` | å“é …è¦æ ¼è¡¨ |
| 9 | `item_number_xref` | é›¶ä»¶è™Ÿç¢¼é—œè¯æª” |
| 10 | `technicaldocument` | æŠ€è¡“æ–‡ä»¶æª” |
| 11 | `item_document_xref` | å“é …æ–‡ä»¶é—œè¯æª” |
| 12 | `application_suppliercode` | å» å•†ä»£è™Ÿç”³è«‹è¡¨ |
| 13 | `cidapplication` | CID ç”³è«‹å–® |

---

## ğŸ”„ è©³ç´°æ¬„ä½æ˜ å°„

### 1. User è¡¨ (`users` â†’ `User`)

**è®Šæ›´èªªæ˜**: 
- âœ… è¡¨åæ”¹ç‚º PascalCase: `users` â†’ `User`
- âœ… æ™‚é–“æˆ³æ¬„ä½é‡æ–°å‘½å: `created_at/updated_at` â†’ `date_created/date_updated`
- âœ… è³‡æ–™é¡å‹èª¿æ•´

| èˆŠæ¬„ä½ (users) | æ–°æ¬„ä½ (User) | è³‡æ–™é¡å‹è®Šæ›´ | èªªæ˜ |
|---------------|--------------|-------------|------|
| **æ ¸å¿ƒæ¬„ä½** | | | |
| `id` | `id` | UUID â†’ UUID | âœ… ç›´æ¥å°æ‡‰ |
| `username` | `username` | VARCHAR(80) | âœ… ç›´æ¥å°æ‡‰ |
| `email` | `email` | VARCHAR(120) | âœ… ç›´æ¥å°æ‡‰ |
| `password_hash` | `password_hash` | VARCHAR(256) | âœ… ç›´æ¥å°æ‡‰ |
| `english_code` | `english_code` | VARCHAR(10) | âœ… ç›´æ¥å°æ‡‰ |
| `full_name` | `full_name` | VARCHAR(100) | âœ… ç›´æ¥å°æ‡‰ |
| `department` | `department` | VARCHAR(100) | âœ… ç›´æ¥å°æ‡‰ |
| `position` | `position` | VARCHAR(100) | âœ… ç›´æ¥å°æ‡‰ |
| `phone` | `phone` | VARCHAR(50) â†’ VARCHAR(20) | âš ï¸ é•·åº¦ç¸®çŸ­ |
| `role` | `role` | VARCHAR(20) â†’ VARCHAR(50) | âœ… é•·åº¦å¢åŠ  |
| `is_active` | `is_active` | BOOLEAN | âœ… ç›´æ¥å°æ‡‰ |
| `is_verified` | `is_verified` | BOOLEAN | âœ… ç›´æ¥å°æ‡‰ |
| `email_verified_at` | `email_verified_at` | TIMESTAMP | âœ… ç›´æ¥å°æ‡‰ |
| `last_login_at` | `last_login_at` | TIMESTAMP | âœ… ç›´æ¥å°æ‡‰ |
| `failed_login_attempts` | `failed_login_attempts` | INTEGER | âœ… ç›´æ¥å°æ‡‰ |
| `locked_until` | `locked_until` | TIMESTAMP | âœ… ç›´æ¥å°æ‡‰ |
| **æ™‚é–“æˆ³æ¬„ä½** | | | |
| `created_at` | `date_created` | TIMESTAMP | âœ… é‡æ–°å‘½å |
| `updated_at` | `date_updated` | TIMESTAMP | âœ… é‡æ–°å‘½å |

**é·ç§»æ³¨æ„äº‹é …**:
- âš ï¸ `phone` æ¬„ä½é•·åº¦å¾ 50 ç¸®çŸ­è‡³ 20ï¼Œéœ€ç¢ºèªç¾æœ‰è³‡æ–™ä¸è¶…é 20 å­—å…ƒ
- âœ… `role` æ¬„ä½é•·åº¦å¢åŠ ï¼Œç„¡å•é¡Œ

---

### 2. Application è¡¨ (`applications` â†’ `application` + é—œè¯è¡¨)

**é‡å¤§è®Šæ›´èªªæ˜**:
- ğŸ”„ **æ ¸å¿ƒæ¶æ§‹é‡æ§‹**: å¾å–®ä¸€å¤§è¡¨æ‹†åˆ†ç‚ºå¤šè¡¨é—œè¯è¨­è¨ˆ
- âœ… ä¿ç•™æ ¸å¿ƒç”³ç·¨å–®æ¬„ä½ï¼ˆ20 å€‹æ¬„ä½ï¼‰
- âœ… æ–™ä»¶å±¬æ€§ç§»è‡³ `item_material_ext` è¡¨
- âœ… è£å‚™å±¬æ€§ç§»è‡³ `item_equipment_ext` è¡¨
- âœ… é›¶ä»¶è™Ÿç¢¼ç§»è‡³ `item_number_xref` è¡¨
- âœ… å» å•†è³‡è¨Šç§»è‡³ `supplier` è¡¨
- âœ… æŠ€è¡“æ–‡ä»¶ç§»è‡³ `technicaldocument` è¡¨
- ğŸ†• æ–°å¢ `item_uuid` å¤–éµé—œè¯è‡³ `item` è¡¨ï¼ˆæ ¸å¿ƒæ•´åˆé»ï¼‰

#### 2.1 Application è¡¨æ¬„ä½å°æ‡‰è¡¨ï¼ˆèˆŠ â†’ æ–°ï¼‰

ä¸‹è¡¨é¡¯ç¤ºèˆŠç‰ˆç”³ç·¨å–®è¡¨ï¼ˆ51 æ¬„ä½ï¼‰èˆ‡æ–°ç‰ˆ `web_app.application` è¡¨ï¼ˆ20 æ¬„ä½ï¼‰çš„æ¬„ä½å°æ‡‰é—œä¿‚ï¼š

| èˆŠç‰ˆæ¬„ä½ | æ–°ç‰ˆæ¬„ä½ (application) | è³‡æ–™é·ç§»èªªæ˜ |
|------------------------|----------------------|-------------|
| **æ ¸å¿ƒæ¬„ä½ï¼ˆä¿ç•™ï¼‰** | | |
| `id` | `id` | âœ… ç›´æ¥å°æ‡‰ |
| `user_id` | `user_id` | âœ… ç›´æ¥å°æ‡‰ |
| `form_serial_number` | `form_serial_number` | âœ… ç›´æ¥å°æ‡‰ |
| `status` | `status` | âœ… ç›´æ¥å°æ‡‰ |
| `sub_status` | `sub_status` | âœ… ç›´æ¥å°æ‡‰ |
| `created_at` | `date_created` | âœ… æ¬„ä½æ”¹å |
| `updated_at` | `date_updated` | âœ… æ¬„ä½æ”¹å |
| `deleted_at` | `deleted_at` | âœ… ç›´æ¥å°æ‡‰ |
| `system_code` | `system_code` | âœ… ç›´æ¥å°æ‡‰ |
| `mrc_data` | `mrc_data` | âœ… ç›´æ¥å°æ‡‰ï¼ˆJSONï¼‰ |
| `applicant_unit` | `applicant_unit` | âœ… ç›´æ¥å°æ‡‰ |
| `contact_info` | `contact_info` | âœ… ç›´æ¥å°æ‡‰ |
| `apply_date` | `apply_date` | âœ… ç›´æ¥å°æ‡‰ |
| `official_nsn_stamp` | `official_nsn_stamp` | âœ… ç›´æ¥å°æ‡‰ |
| `official_nsn_final` | `official_nsn_final` | âœ… ç›´æ¥å°æ‡‰ |
| `nsn_filled_at` | `nsn_filled_at` | âœ… ç›´æ¥å°æ‡‰ |
| `nsn_filled_by` | `nsn_filled_by` | âœ… ç›´æ¥å°æ‡‰ |
| `closed_at` | `closed_at` | âœ… ç›´æ¥å°æ‡‰ |
| `closed_by` | `closed_by` | âœ… ç›´æ¥å°æ‡‰ |
| **æ–°å¢æ¬„ä½** | | |
| - | `item_uuid` | ğŸ†• é—œè¯è‡³ Item è¡¨ï¼ˆæ ¸å¿ƒæ•´åˆé»ï¼‰ |
| **ç§»é™¤æ¬„ä½ï¼ˆæ–™ä»¶å±¬æ€§ï¼‰** | | |
| `part_number` | âŒ ç§»é™¤ | â†’ `item.item_code` |
| `english_name` | âŒ ç§»é™¤ | â†’ `item.item_name_en` |
| `chinese_name` | âŒ ç§»é™¤ | â†’ `item.item_name_zh` |
| `inc_code` | âŒ ç§»é™¤ | â†’ `item_material_ext.inc_code` |
| `fiig_code` | âŒ ç§»é™¤ | â†’ `item_material_ext.fiig_code` |
| `accounting_unit_code` | âŒ ç§»é™¤ | â†’ `item_material_ext.accounting_code` |
| `issue_unit` | âŒ ç§»é™¤ | â†’ `item_material_ext.issue_unit` |
| `unit_price` | âŒ ç§»é™¤ | â†’ `item_material_ext.unit_price` |
| `spec_indicator` | âŒ ç§»é™¤ | â†’ `item_material_ext.spec_indicator` |
| `unit_pack_quantity` | âŒ ç§»é™¤ | â†’ `item_material_ext.unit_pack_quantity` |
| `storage_life_months` | âŒ ç§»é™¤ | â†’ `item_material_ext.storage_life_months` |
| `storage_life_action_code` | âŒ ç§»é™¤ | â†’ `item_material_ext.storage_life_action_code` |
| `storage_type_code` | âŒ ç§»é™¤ | â†’ `item_material_ext.storage_type_code` |
| `secrecy_code` | âŒ ç§»é™¤ | â†’ `item_material_ext.secrecy_code` |
| `expendability_code` | âŒ ç§»é™¤ | â†’ `item_material_ext.expendability_code` |
| `repairability_code` | âŒ ç§»é™¤ | â†’ `item_material_ext.repairability_code` |
| `manufacturability_code` | âŒ ç§»é™¤ | â†’ `item_material_ext.manufacturability_code` |
| `source_code` | âŒ ç§»é™¤ | â†’ `item_material_ext.source_code` |
| `category_code` | âŒ ç§»é™¤ | â†’ `item_material_ext.category_code` |
| **ç§»é™¤æ¬„ä½ï¼ˆè£å‚™å±¬æ€§ï¼‰** | | |
| `ship_type` | âŒ ç§»é™¤ | â†’ `item_equipment_ext.ship_type` |
| `model_type` | âŒ ç§»é™¤ | â†’ `item_equipment_ext.equipment_type` |
| `equipment_name` | âŒ ç§»é™¤ | â†’ `item.item_name_zh/en` |
| `usage_location` | âŒ ç§»é™¤ | â†’ `item_equipment_ext.usage_location` |
| `quantity_per_unit` | âŒ ç§»é™¤ | â†’ `item_material_ext.unit_pack_quantity` |
| **ç§»é™¤æ¬„ä½ï¼ˆé›¶ä»¶è™Ÿç¢¼ï¼‰** | | |
| `pn_acquisition_level` | âŒ ç§»é™¤ | â†’ `item_number_xref.pn_acquisition_level` |
| `pn_acquisition_source` | âŒ ç§»é™¤ | â†’ `item_number_xref.pn_acquisition_source` |
| `part_number_reference` | âŒ ç§»é™¤ | â†’ `item_number_xref.part_number_reference` |
| **ç§»é™¤æ¬„ä½ï¼ˆå» å•†è³‡è¨Šï¼‰** | | |
| `manufacturer` | âŒ ç§»é™¤ | â†’ `supplier.supplier_name_en` |
| `manufacturer_name` | âŒ ç§»é™¤ | â†’ `supplier.supplier_name_en` |
| `agent_name` | âŒ ç§»é™¤ | â†’ `supplier.agent_name` |
| **ç§»é™¤æ¬„ä½ï¼ˆå…¶ä»–ï¼‰** | | |
| `cid_no` | âŒ ç§»é™¤ | â†’ `item.item_code` (CID) |
| `document_reference` | âŒ ç§»é™¤ | â†’ `technicaldocument.document_reference` |

**æ¬„ä½çµ±è¨ˆ**:
- èˆŠç‰ˆç¸½æ¬„ä½æ•¸: **51 å€‹**
- æ–°ç‰ˆç¸½æ¬„ä½æ•¸: **20 å€‹**
- ä¿ç•™æ¬„ä½: **17 å€‹**ï¼ˆå« 2 å€‹æ”¹åæ¬„ä½ï¼šcreated_atâ†’date_created, updated_atâ†’date_updatedï¼‰
- æ–°å¢æ¬„ä½: **1 å€‹** (`item_uuid`)
- ç§»é™¤æ¬„ä½: **34 å€‹**ï¼ˆåŒ…å« 32 å€‹ç§»è‡³é—œè¯è¡¨ + 2 å€‹é‡è¤‡æ™‚é–“æ¬„ä½ï¼‰

#### 2.2 ç§»é™¤æ¬„ä½è©³ç´°èªªæ˜

ä»¥ä¸‹ç‚ºç§»é™¤æ¬„ä½çš„æ–°ä½ç½®èˆ‡é—œè¯æ–¹å¼è©³ç´°èªªæ˜ï¼š

##### å“é …åŸºæœ¬è³‡è¨Š â†’ `item` è¡¨

| èˆŠæ¬„ä½ (applications) | æ–°è¡¨.æ–°æ¬„ä½ | èªªæ˜ |
|---------------------|-----------|------|
| `part_number` | `item.item_code` | çµ±ä¸€è­˜åˆ¥ç¢¼ï¼ˆCID æˆ– NIINï¼‰ |
| `english_name` | `item.item_name_en` | è‹±æ–‡å“å |
| `chinese_name` | `item.item_name_zh` | ä¸­æ–‡å“å |
| `cid_no` | `item.item_code` | èˆ‡ part_number åˆä½µ |

**é—œè¯æ–¹å¼**: é€é `application.item_uuid` â†’ `item.item_uuid` å¤–éµé—œè¯

##### æ–™ä»¶å±¬æ€§ â†’ `item_material_ext` è¡¨

| èˆŠæ¬„ä½ (applications) | æ–°è¡¨.æ–°æ¬„ä½ | èªªæ˜ |
|---------------------|-----------|------|
| `inc_code` | `item_material_ext.inc_code` | INC ä»£ç¢¼ |
| `fiig_code` | `item_material_ext.fiig_code` | FIIG ä»£ç¢¼ |
| `accounting_unit_code` | `item_material_ext.accounting_code` | æœƒè¨ˆç·¨è™Ÿ |
| `issue_unit` | `item_material_ext.issue_unit` | æ’¥ç™¼å–®ä½ |
| `unit_price` | `item_material_ext.unit_price` | ç¾é‡‘å–®åƒ¹ |
| `spec_indicator` | `item_material_ext.spec_indicator` | è¦æ ¼æŒ‡ç¤º |
| `unit_pack_quantity` | `item_material_ext.unit_pack_quantity` | å–®ä½åŒ…è£é‡ |
| `storage_life_months` | `item_material_ext.storage_life_months` | å­˜å„²å£½é™ä»£è™Ÿ |
| `storage_life_action_code` | `item_material_ext.storage_life_action_code` | è™•ç†ä»£è™Ÿ |
| `storage_type_code` | `item_material_ext.storage_type_code` | å„²å­˜å‹å¼ |
| `secrecy_code` | `item_material_ext.secrecy_code` | æ©Ÿå¯†æ€§ä»£è™Ÿ |
| `expendability_code` | `item_material_ext.expendability_code` | æ¶ˆè€—æ€§ä»£è™Ÿ |
| `repairability_code` | `item_material_ext.repairability_code` | ä¿®ç†èƒ½é‡ |
| `manufacturability_code` | `item_material_ext.manufacturability_code` | è£½é€ èƒ½é‡ |
| `source_code` | `item_material_ext.source_code` | ä¾†æºä»£è™Ÿ |
| `category_code` | `item_material_ext.category_code` | çµ±ä¸€çµ„é¡åˆ¥ |

**é—œè¯æ–¹å¼**: `application.item_uuid` â†’ `item.item_uuid` â† `item_material_ext.item_uuid`

##### è£å‚™å±¬æ€§ â†’ `item_equipment_ext` è¡¨

| èˆŠæ¬„ä½ (applications) | æ–°è¡¨.æ–°æ¬„ä½ | èªªæ˜ |
|---------------------|-----------|------|
| `ship_type` | `item_equipment_ext.ship_type` | è‰¦å‹ |
| `model_type` | `item_equipment_ext.equipment_type` | âš ï¸ æ¬„ä½åè®Šæ›´ |
| `equipment_name` | `item.item_name_zh/en` | åˆä½µè‡³å“å |
| `usage_location` | `item_equipment_ext.usage_location` | è£è¨­åœ°é» |
| `quantity_per_unit` | `item_material_ext.unit_pack_quantity` | ç§»è‡³æ–™ä»¶è¡¨ |

**é—œè¯æ–¹å¼**: `application.item_uuid` â†’ `item.item_uuid` â† `item_equipment_ext.item_uuid`

##### é›¶ä»¶è™Ÿç¢¼ â†’ `item_number_xref` è¡¨

| èˆŠæ¬„ä½ (applications) | æ–°è¡¨.æ–°æ¬„ä½ | èªªæ˜ |
|---------------------|-----------|------|
| `pn_acquisition_level` | `item_number_xref.pn_acquisition_level` | P/N ç²å¾—ç¨‹åº¦ |
| `pn_acquisition_source` | `item_number_xref.pn_acquisition_source` | P/N ç²å¾—ä¾†æº |
| `part_number_reference` | `item_number_xref.part_number_reference` | é…ä»¶è™Ÿç¢¼ï¼ˆP/Nï¼‰ |

**é—œè¯æ–¹å¼**: `application.item_uuid` â†’ `item.item_uuid` â† `item_number_xref.item_uuid`

##### å» å•†è³‡è¨Š â†’ `supplier` è¡¨

| èˆŠæ¬„ä½ (applications) | æ–°è¡¨.æ–°æ¬„ä½ | èªªæ˜ |
|---------------------|-----------|------|
| `manufacturer` | `supplier.supplier_name_en` | å» å®¶è£½é€ å•†ï¼ˆè‹±æ–‡ï¼‰ |
| `manufacturer_name` | `supplier.supplier_name_en` | å» å®¶è£½é€ å•†ï¼ˆè‹±æ–‡ï¼‰ |
| `agent_name` | `supplier.agent_name` | ä»£ç†å•†åç¨± |

**é—œè¯æ–¹å¼**: `application.item_uuid` â†’ `item.item_uuid` â† `item_number_xref.item_uuid` â†’ `item_number_xref.supplier_id` â†’ `supplier.supplier_id`

##### æŠ€è¡“æ–‡ä»¶ â†’ `technicaldocument` è¡¨

| èˆŠæ¬„ä½ (applications) | æ–°è¡¨.æ–°æ¬„ä½ | èªªæ˜ |
|---------------------|-----------|------|
| `document_reference` | `technicaldocument.document_reference` | åœ–å/æ›¸å |

**é—œè¯æ–¹å¼**: `application.item_uuid` â†’ `item.item_uuid` â† `item_document_xref.item_uuid` â†’ `item_document_xref.document_id` â†’ `technicaldocument.document_id`

#### 2.3 æ¬„ä½çµ±è¨ˆç¸½è¡¨

| é¡åˆ¥ | æ¬„ä½æ•¸é‡ | èªªæ˜ |
|------|---------|------|
| **èˆŠç‰ˆç¸½æ¬„ä½æ•¸** | 51 | applications è¡¨åŸæœ‰æ¬„ä½ |
| **æ–°ç‰ˆç¸½æ¬„ä½æ•¸** | 20 | application è¡¨ç²¾ç°¡å¾Œæ¬„ä½ |
| **ä¿ç•™æ¬„ä½** | 17 | å« 2 å€‹æ”¹åæ¬„ä½ï¼ˆcreated_atâ†’date_created, updated_atâ†’date_updatedï¼‰ |
| **æ–°å¢æ¬„ä½** | 1 | `item_uuid`ï¼ˆé—œè¯è‡³ Item è¡¨ï¼‰ |
| **ç§»é™¤æ¬„ä½** | 34 | 32 å€‹ç§»è‡³é—œè¯è¡¨ + 2 å€‹é‡è¤‡æ™‚é–“æ¬„ä½ |

**ç§»é™¤æ¬„ä½åˆ†å¸ƒ**:

| ç›®æ¨™è¡¨ | æ¬„ä½æ•¸é‡ | èªªæ˜ |
|-------|---------|------|
| `item` | 4 | å“é …åŸºæœ¬è³‡è¨Šï¼ˆpart_number, english_name, chinese_name, cid_noï¼‰ |
| `item_material_ext` | 16 | æ–™ä»¶å±¬æ€§ |
| `item_equipment_ext` | 5 | è£å‚™å±¬æ€§ |
| `item_number_xref` | 3 | é›¶ä»¶è™Ÿç¢¼é—œè¯ |
| `supplier` | 3 | å» å•†è³‡è¨Š |
| `technicaldocument` | 1 | æŠ€è¡“æ–‡ä»¶ |
| **å°è¨ˆ** | 32 | ç§»è‡³é—œè¯è¡¨çš„æ¬„ä½ |

---

### 3. ApplicationAttachment è¡¨ (`application_attachments` â†’ `applicationattachment`)

**è®Šæ›´èªªæ˜**:
- âœ… è¡¨åæ”¹ç‚º PascalCase: `application_attachments` â†’ `applicationattachment`
- âœ… æ™‚é–“æˆ³æ¬„ä½é‡æ–°å‘½å

| èˆŠæ¬„ä½ (application_attachments) | æ–°æ¬„ä½ (applicationattachment) | è³‡æ–™é¡å‹ | èªªæ˜ |
|--------------------------------|------------------------------|---------|------|
| `id` | `id` | UUID | âœ… ç›´æ¥å°æ‡‰ |
| `application_id` | `application_id` | UUID | âœ… ç›´æ¥å°æ‡‰ |
| `user_id` | `user_id` | UUID | âœ… ç›´æ¥å°æ‡‰ |
| `file_data` | `file_data` | BYTEA | âœ… ç›´æ¥å°æ‡‰ |
| `filename` | `filename` | VARCHAR(255) | âœ… ç›´æ¥å°æ‡‰ |
| `original_filename` | `original_filename` | VARCHAR(255) | âœ… ç›´æ¥å°æ‡‰ |
| `mimetype` | `mimetype` | VARCHAR(100) | âœ… ç›´æ¥å°æ‡‰ |
| `file_type` | `file_type` | VARCHAR(20) | âœ… ç›´æ¥å°æ‡‰ |
| `page_selection` | `page_selection` | VARCHAR(200) | âœ… ç›´æ¥å°æ‡‰ |
| `sort_order` | `sort_order` | INTEGER | âœ… ç›´æ¥å°æ‡‰ |
| `created_at` | `date_created` | TIMESTAMP | âœ… é‡æ–°å‘½å |
| `updated_at` | `date_updated` | TIMESTAMP | âœ… é‡æ–°å‘½å |

**æ¬„ä½çµ±è¨ˆ**: 12 å€‹æ¬„ä½ï¼ˆ10 ç›´æ¥å°æ‡‰ + 2 é‡æ–°å‘½åï¼‰

---

### 4. UserSession è¡¨ (`user_sessions` â†’ `usersession`)

**è®Šæ›´èªªæ˜**:
- âœ… è¡¨åæ”¹ç‚º PascalCase: `user_sessions` â†’ `usersession`
- âœ… æ™‚é–“æˆ³æ¬„ä½é‡æ–°å‘½å

| èˆŠæ¬„ä½ (user_sessions) | æ–°æ¬„ä½ (usersession) | è³‡æ–™é¡å‹ | èªªæ˜ |
|-----------------------|---------------------|---------|------|
| `session_id` | `session_id` | VARCHAR(255) | âœ… ç›´æ¥å°æ‡‰ |
| `user_id` | `user_id` | UUID | âœ… ç›´æ¥å°æ‡‰ |
| `ip_address` | `ip_address` | VARCHAR(45) | âœ… ç›´æ¥å°æ‡‰ |
| `user_agent` | `user_agent` | TEXT | âœ… ç›´æ¥å°æ‡‰ |
| `is_active` | `is_active` | BOOLEAN | âœ… ç›´æ¥å°æ‡‰ |
| `remember_me` | `remember_me` | BOOLEAN | âœ… ç›´æ¥å°æ‡‰ |
| `expires_at` | `expires_at` | TIMESTAMP | âœ… ç›´æ¥å°æ‡‰ |
| `created_at` | `date_created` | TIMESTAMP | âœ… é‡æ–°å‘½å |
| `last_activity_at` | `last_activity_at` | TIMESTAMP | âœ… ç›´æ¥å°æ‡‰ |

**æ¬„ä½çµ±è¨ˆ**: 9 å€‹æ¬„ä½ï¼ˆ8 ç›´æ¥å°æ‡‰ + 1 é‡æ–°å‘½åï¼‰

---

### 5. ApplicationLog è¡¨ (`application_logs` â†’ `applicationlog`)

**è®Šæ›´èªªæ˜**:
- âœ… è¡¨åæ”¹ç‚º PascalCase: `application_logs` â†’ `applicationlog`
- âœ… æ‰€æœ‰æ¬„ä½ä¿æŒä¸€è‡´

| èˆŠæ¬„ä½ (application_logs) | æ–°æ¬„ä½ (applicationlog) | è³‡æ–™é¡å‹ | èªªæ˜ |
|--------------------------|------------------------|---------|------|
| `log_id` | `log_id` | UUID | âœ… ç›´æ¥å°æ‡‰ |
| `timestamp` | `timestamp` | TIMESTAMPTZ | âœ… ç›´æ¥å°æ‡‰ |
| `level` | `level` | VARCHAR(10) | âœ… ç›´æ¥å°æ‡‰ |
| `logger` | `logger` | VARCHAR(100) | âœ… ç›´æ¥å°æ‡‰ |
| `message` | `message` | TEXT | âœ… ç›´æ¥å°æ‡‰ |
| `request_id` | `request_id` | VARCHAR(36) | âœ… ç›´æ¥å°æ‡‰ |
| `method` | `method` | VARCHAR(10) | âœ… ç›´æ¥å°æ‡‰ |
| `path` | `path` | VARCHAR(500) | âœ… ç›´æ¥å°æ‡‰ |
| `status_code` | `status_code` | INTEGER | âœ… ç›´æ¥å°æ‡‰ |
| `elapsed_time_ms` | `elapsed_time_ms` | NUMERIC(10,2) | âœ… ç›´æ¥å°æ‡‰ |
| `user_id` | `user_id` | UUID | âœ… ç›´æ¥å°æ‡‰ |
| `remote_addr` | `remote_addr` | INET | âœ… ç›´æ¥å°æ‡‰ |
| `user_agent` | `user_agent` | TEXT | âœ… ç›´æ¥å°æ‡‰ |
| `module` | `module` | VARCHAR(100) | âœ… ç›´æ¥å°æ‡‰ |
| `function` | `function` | VARCHAR(100) | âœ… ç›´æ¥å°æ‡‰ |
| `line` | `line` | INTEGER | âœ… ç›´æ¥å°æ‡‰ |
| `exception_type` | `exception_type` | VARCHAR(100) | âœ… ç›´æ¥å°æ‡‰ |
| `exception_message` | `exception_message` | TEXT | âœ… ç›´æ¥å°æ‡‰ |
| `exception_traceback` | `exception_traceback` | JSONB | âœ… ç›´æ¥å°æ‡‰ |
| `extra_fields` | `extra_fields` | JSONB | âœ… ç›´æ¥å°æ‡‰ |
| `created_date` | `created_date` | DATE | âœ… ç›´æ¥å°æ‡‰ |

**æ¬„ä½çµ±è¨ˆ**: 21 å€‹æ¬„ä½ï¼ˆå…¨éƒ¨ç›´æ¥å°æ‡‰ï¼‰

---

### 6. AuditLog è¡¨ (`audit_logs` â†’ `auditlog`)

**è®Šæ›´èªªæ˜**:
- âœ… è¡¨åæ”¹ç‚º PascalCase: `audit_logs` â†’ `auditlog`
- âœ… æ™‚é–“æˆ³æ¬„ä½é‡æ–°å‘½å

| èˆŠæ¬„ä½ (audit_logs) | æ–°æ¬„ä½ (auditlog) | è³‡æ–™é¡å‹ | èªªæ˜ |
|--------------------|------------------|---------|------|
| `log_id` | `log_id` | UUID | âœ… ç›´æ¥å°æ‡‰ |
| `user_id` | `user_id` | UUID | âœ… ç›´æ¥å°æ‡‰ |
| `action` | `action` | VARCHAR(100) | âœ… ç›´æ¥å°æ‡‰ |
| `resource_type` | `resource_type` | VARCHAR(50) | âœ… ç›´æ¥å°æ‡‰ |
| `resource_id` | `resource_id` | VARCHAR(100) | âœ… ç›´æ¥å°æ‡‰ |
| `old_values` | `old_values` | JSON | âœ… ç›´æ¥å°æ‡‰ |
| `new_values` | `new_values` | JSON | âœ… ç›´æ¥å°æ‡‰ |
| `ip_address` | `ip_address` | VARCHAR(45) | âœ… ç›´æ¥å°æ‡‰ |
| `user_agent` | `user_agent` | TEXT | âœ… ç›´æ¥å°æ‡‰ |
| `success` | `success` | BOOLEAN | âœ… ç›´æ¥å°æ‡‰ |
| `error_message` | `error_message` | TEXT | âœ… ç›´æ¥å°æ‡‰ |
| `created_at` | `date_created` | TIMESTAMP | âœ… é‡æ–°å‘½å |

**æ¬„ä½çµ±è¨ˆ**: 12 å€‹æ¬„ä½ï¼ˆ11 ç›´æ¥å°æ‡‰ + 1 é‡æ–°å‘½åï¼‰

---

### 7. å·²ç§»é™¤çš„è¡¨æ ¼

ä»¥ä¸‹è¡¨æ ¼åœ¨æ–°è³‡æ–™åº«ä¸­å·²ç§»é™¤ï¼ŒåŠŸèƒ½è¢«æ•´åˆæˆ–ä¸å†éœ€è¦ï¼š

| èˆŠè¡¨å | ç‹€æ…‹ | èªªæ˜ |
|--------|------|------|
| `search_history` | âŒ å·²ç§»é™¤ | æœå°‹æ­·å²åŠŸèƒ½æš«æ™‚ç§»é™¤ |
| `user_favorites` | âŒ å·²ç§»é™¤ | ä½¿ç”¨è€…æ”¶è—åŠŸèƒ½æš«æ™‚ç§»é™¤ |
| `user_settings` | âŒ å·²ç§»é™¤ | ä½¿ç”¨è€…è¨­å®šåŠŸèƒ½æš«æ™‚ç§»é™¤ |
| `system_settings` | âŒ å·²ç§»é™¤ | ç³»çµ±è¨­å®šåŠŸèƒ½æš«æ™‚ç§»é™¤ |
| `system_statistics` | âŒ å·²ç§»é™¤ | ç³»çµ±çµ±è¨ˆåŠŸèƒ½æš«æ™‚ç§»é™¤ |

**æ³¨æ„**: è‹¥æœªä¾†éœ€è¦é€™äº›åŠŸèƒ½ï¼Œå¯é‡æ–°å»ºç«‹è¡¨æ ¼ã€‚

---

## ğŸ“– è³‡æ–™æŸ¥è©¢ç¯„ä¾‹

### ç¯„ä¾‹ 1: æŸ¥è©¢ç”³ç·¨å–®å®Œæ•´è³‡è¨Šï¼ˆèˆŠ vs æ–°ï¼‰

#### èˆŠè³‡æ–™åº«æŸ¥è©¢ï¼ˆå–®ä¸€è¡¨ï¼‰

```sql
-- V1.0: æ‰€æœ‰è³‡æ–™åœ¨ä¸€å€‹è¡¨
SELECT 
    id,
    form_serial_number,
    part_number,
    english_name,
    chinese_name,
    manufacturer,
    inc_code,
    fiig_code,
    status
FROM web_app.applications
WHERE id = 'xxx';
```

#### æ–°è³‡æ–™åº«æŸ¥è©¢ï¼ˆå¤šè¡¨é—œè¯ï¼‰

```sql
-- V3.2: é€éé—œè¯æŸ¥è©¢
SELECT 
    -- ç”³ç·¨å–®æ ¸å¿ƒè³‡è¨Š
    a.id,
    a.form_serial_number,
    a.status,
    a.sub_status,
    
    -- å“é …åŸºæœ¬è³‡è¨Šï¼ˆä¾†è‡ª item è¡¨ï¼‰
    i.item_code AS part_number,
    i.item_name_en AS english_name,
    i.item_name_zh AS chinese_name,
    
    -- æ–™ä»¶å±¬æ€§ï¼ˆä¾†è‡ª item_material_ext è¡¨ï¼‰
    ime.inc_code,
    ime.fiig_code,
    ime.accounting_unit_code,
    ime.issue_unit,
    ime.unit_price,
    
    -- é›¶ä»¶è™Ÿç¢¼ï¼ˆä¾†è‡ª item_number_xref è¡¨ï¼‰
    inx.part_number_reference,
    inx.pn_acquisition_level,
    
    -- å» å•†è³‡è¨Šï¼ˆä¾†è‡ª supplier è¡¨ï¼‰
    s.supplier_name_en AS manufacturer,
    s.agent_name,
    
    -- æŠ€è¡“æ–‡ä»¶ï¼ˆä¾†è‡ª technicaldocument è¡¨ï¼‰
    td.document_reference

FROM web_app.application a
LEFT JOIN web_app.item i ON a.item_uuid = i.item_uuid
LEFT JOIN web_app.item_material_ext ime ON i.item_uuid = ime.item_uuid
LEFT JOIN web_app.item_number_xref inx ON i.item_uuid = inx.item_uuid
LEFT JOIN web_app.supplier s ON inx.supplier_id = s.supplier_id
LEFT JOIN web_app.item_document_xref idx ON i.item_uuid = idx.item_uuid
LEFT JOIN web_app.technicaldocument td ON idx.document_id = td.document_id
WHERE a.id = 'xxx';
```

### ç¯„ä¾‹ 2: æŸ¥è©¢è£å‚™è³‡è¨Š

```sql
-- V3.2: æŸ¥è©¢è£å‚™æ“´å±•è³‡è¨Š
SELECT 
    i.item_code,
    i.item_name_zh,
    iee.ship_type,
    iee.equipment_type,
    iee.usage_location,
    iee.installation_qty,
    iee.eswbs_code
FROM web_app.item i
INNER JOIN web_app.item_equipment_ext iee ON i.item_uuid = iee.item_uuid
WHERE i.item_type = 'FG';
```

---

## ğŸ”„ è³‡æ–™é·ç§»æ­¥é©Ÿå»ºè­°

### æ­¥é©Ÿ 1: å»ºç«‹å“é …ä¸»æª” (item)

```sql
-- å¾ applications æå–å”¯ä¸€å“é …è³‡æ–™
INSERT INTO web_app.item (item_uuid, item_code, item_name_zh, item_name_en, item_type, status)
SELECT 
    gen_random_uuid() AS item_uuid,
    COALESCE(part_number, cid_no) AS item_code,
    chinese_name AS item_name_zh,
    english_name AS item_name_en,
    'RM' AS item_type,  -- æ ¹æ“šå¯¦éš›æƒ…æ³èª¿æ•´
    'Active' AS status
FROM web_app.applications
WHERE part_number IS NOT NULL
GROUP BY part_number, chinese_name, english_name, cid_no;
```

### æ­¥é©Ÿ 2: å»ºç«‹æ–™ä»¶æ“´å±•è³‡æ–™ (item_material_ext)

```sql
-- å°‡æ–™ä»¶å±¬æ€§è³‡æ–™é·ç§»è‡³ item_material_ext
INSERT INTO web_app.item_material_ext (
    item_uuid, inc_code, fiig_code, accounting_unit_code, 
    issue_unit, unit_price, category_code, ...
)
SELECT 
    i.item_uuid,
    a.inc_code,
    a.fiig_code,
    a.accounting_unit_code,
    a.issue_unit,
    a.unit_price,
    a.category_code,
    ...
FROM web_app.applications a
INNER JOIN web_app.item i ON i.item_code = COALESCE(a.part_number, a.cid_no);
```

### æ­¥é©Ÿ 3: å»ºç«‹å» å•†ä¸»æª” (supplier)

```sql
-- å¾ applications æå–å”¯ä¸€å» å•†è³‡æ–™
INSERT INTO web_app.supplier (supplier_name_en, agent_name)
SELECT DISTINCT
    manufacturer AS supplier_name_en,
    agent_name
FROM web_app.applications
WHERE manufacturer IS NOT NULL;
```

### æ­¥é©Ÿ 4: æ›´æ–° application è¡¨

```sql
-- æ›´æ–° application è¡¨ï¼Œæ–°å¢ item_uuid é—œè¯
UPDATE web_app.application a
SET item_uuid = i.item_uuid
FROM web_app.item i
WHERE i.item_code = (
    SELECT COALESCE(part_number, cid_no)
    FROM web_app.applications old_a
    WHERE old_a.id = a.id
);
```

### æ­¥é©Ÿ 5: é‡æ–°å‘½åæ™‚é–“æˆ³æ¬„ä½

```sql
-- å‡è¨­å¾èˆŠè¡¨é·ç§»æ™‚é–“æˆ³
UPDATE web_app.application a
SET 
    date_created = old_a.created_at,
    date_updated = old_a.updated_at
FROM web_app.applications old_a
WHERE a.id = old_a.id;
```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### 1. è³‡æ–™å®Œæ•´æ€§æª¢æŸ¥

- âœ… ç¢ºèªæ‰€æœ‰ `applications` ä¸­çš„ `part_number` éƒ½èƒ½å°æ‡‰åˆ° `item` è¡¨
- âœ… æª¢æŸ¥å¤–éµç´„æŸæ˜¯å¦æ­£ç¢ºå»ºç«‹
- âœ… é©—è­‰å¿…å¡«æ¬„ä½ä¸ç‚º NULL

### 2. è³‡æ–™é¡å‹è®Šæ›´

| æ¬„ä½ | èˆŠé¡å‹ | æ–°é¡å‹ | æ³¨æ„äº‹é … |
|------|--------|--------|---------|
| `users.phone` | VARCHAR(50) | VARCHAR(20) | âš ï¸ éœ€æª¢æŸ¥è³‡æ–™é•·åº¦ |
| `users.role` | VARCHAR(20) | VARCHAR(50) | âœ… ç„¡å•é¡Œ |
| `item_material_ext.accounting_unit_code` | VARCHAR(50) | VARCHAR(20) | âš ï¸ éœ€æª¢æŸ¥è³‡æ–™é•·åº¦ |

### 3. æ¬„ä½åç¨±è®Šæ›´æ¸…å–®

| èˆŠæ¬„ä½ | æ–°æ¬„ä½ | å½±éŸ¿ç¯„åœ |
|--------|--------|---------|
| `created_at` | `date_created` | æ‰€æœ‰è¡¨ |
| `updated_at` | `date_updated` | æ‰€æœ‰è¡¨ |

| `model_type` | `equipment_type` | item_equipment_ext |

### 4. ç´¢å¼•é‡å»º

é·ç§»å¾Œéœ€é‡å»ºä»¥ä¸‹ç´¢å¼•ï¼š

```sql
-- ç”³ç·¨å–®ç›¸é—œç´¢å¼•
CREATE INDEX idx_app_item_uuid ON web_app.application(item_uuid);
CREATE INDEX idx_app_status ON web_app.application(status);
CREATE INDEX idx_app_date_created ON web_app.application(date_created);

-- å“é …ç›¸é—œç´¢å¼•
CREATE INDEX idx_item_code ON web_app.item(item_code);
CREATE INDEX idx_item_type ON web_app.item(item_type);

-- æ–™ä»¶æ“´å±•è¡¨ç´¢å¼•
CREATE INDEX idx_material_ext_inc_code ON web_app.item_material_ext(inc_code);
CREATE INDEX idx_material_ext_fiig_code ON web_app.item_material_ext(fiig_code);
```

---

## ğŸ“Š æ˜ å°„ç¸½çµ

### æ¬„ä½æ•¸é‡çµ±è¨ˆ

| é …ç›® | èˆŠè³‡æ–™åº« | æ–°è³‡æ–™åº« | èªªæ˜ |
|------|---------|---------|------|
| **è¡¨æ ¼ç¸½æ•¸** | 11 å€‹ | 19 å€‹ | æ–°å¢ 13 å€‹è£å‚™ç®¡ç†è¡¨ |
| **applications æ¬„ä½** | 51 å€‹ | 20 å€‹ | æ‹†åˆ†è‡³ 7 å€‹è¡¨ |
| **ä¿ç•™çš„è¡¨æ ¼** | 6 å€‹ | 6 å€‹ | é‡æ–°å‘½å |
| **ç§»é™¤çš„è¡¨æ ¼** | 5 å€‹ | - | åŠŸèƒ½æš«æ™‚ç§»é™¤ |
| **æ–°å¢çš„è¡¨æ ¼** | - | 13 å€‹ | è£å‚™ç®¡ç†æ ¸å¿ƒè¡¨ |

### æ¶æ§‹è®Šæ›´æ‘˜è¦

1. **æ­£è¦åŒ–è¨­è¨ˆ**: å¾å–®ä¸€å¤§è¡¨ (applications 51 æ¬„ä½) æ‹†åˆ†ç‚ºå¤šè¡¨é—œè¯è¨­è¨ˆ
2. **è³‡æ–™ä¸€è‡´æ€§**: é€éå¤–éµç´„æŸç¢ºä¿è³‡æ–™å®Œæ•´æ€§
3. **æ“´å……æ€§æå‡**: æ–°å¢ BOMã€è¦æ ¼ã€é›¶ä»¶è™Ÿç¢¼ç­‰å°ˆæ¥­è¡¨æ ¼
4. **å‘½åè¦ç¯„**: çµ±ä¸€ä½¿ç”¨ PascalCase è¡¨åã€snake_case æ¬„ä½å
5. **æ™‚é–“æˆ³çµ±ä¸€**: æ‰€æœ‰è¡¨ä½¿ç”¨ `date_created`/`date_updated` å‘½å

---

## ğŸ“ ç‰ˆæœ¬æ­·å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è®Šæ›´èªªæ˜ |
|------|------|---------|
| V1.1 | 2025-12-26 | æ›´æ–° Application è¡¨æ¬„ä½å°æ‡‰è¡¨ï¼Œèˆ‡ V3.2 è³‡æ–™åº«çµæ§‹æ–‡ä»¶åŒæ­¥ |
| V1.0 | 2025-12-26 | åˆç‰ˆå»ºç«‹ï¼Œå®Œæ•´æ˜ å°„æ–‡ä»¶ |

---

**æ–‡ä»¶ç¶­è­·**: è³‡æ–™åº«ç®¡ç†å“¡  
**è¯çµ¡è³‡è¨Š**: è«‹åƒè€ƒç³»çµ±ç®¡ç†æ–‡ä»¶
